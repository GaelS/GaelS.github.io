<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Comment lier React et le DOM ?TLDR;Pour lier une application React au DOM, il faut utiliser le package ReactDOM et la fonction render avec en paramètr"><meta name="author" content="Gaël Servaud"><meta property="og:title" content="React et le DOM"><meta property="og:site_name" content="Apprendre ReactJS"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><title>React et le DOM - Apprendre ReactJS</title><link rel="stylesheet" href="//unpkg.com/tachyons/css/tachyons.min.css"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]--><link rel="stylesheet" href="/css/style.css"><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-96190899-1","auto"),ga("send","pageview")</script></head><body><div class="w-100 bg-1 ph5-ns ph3 text-light"><nav class="db dt-l w-100 mw8 center border-box pv3"><a class="db dtc-l v-mid link dim w-100 w-25-l tc tl-l mb2 mb0-l white" href="/" title="Apprendre ReactJS"><img src="/images/ReactLogo.svg" class="dib h3" alt="Apprendre ReactJS"></a><div class="db dtc-l v-mid w-100 w-75-l tc tr-l"><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/" title="Home">Home </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/archives" title="Archives">Archives </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/about" title="A propos">A propos</a></div></nav><div class="w-100 mw8 center vh-40 dt"><div class="dtc v-mid white"><h1 class="f1-l f2-m tc tc-m tl-ns">React et le DOM</h1><p class="f4 fw3 pab-100px tc tc-m tl-ns">31/03/2017</p></div></div><div class="relative w-100 mw8 center white dn dn-m db-ns"><i class="header-icon fa fa-code"></i></div></div><div class="w-100 ph2 ph4-m ph5-l mv5 mv6-l"><div class="content"><div class="mw8 center"><div class="cf"><div class="fl w-100 w-70-l mw7 left fw3 lh-copy pr4-ns pr0-m post-content"><div class="tags-container-vertical"><div class="tags-sub-container"><a class="fw3 ph1 dib" href="/tags/bases/">#bases</a> <a class="fw3 ph1 dib" href="/tags/dom/">#dom</a></div></div><h1 id="Comment-lier-React-et-le-DOM"><a href="#Comment-lier-React-et-le-DOM" class="headerlink" title="Comment lier React et le DOM ?"></a>Comment lier React et le DOM ?</h1><blockquote><p>TLDR;</p><ul><li>Pour lier une application React au DOM, il faut utiliser le package ReactDOM et la fonction render avec en paramètres, le composant racine de l’application et le noeud du DOM auquel il sera rattaché.</li></ul><p><code>ReactDOM.render( &lt;MonApplication /&gt;, document.getElementById(&#39;root&#39;) );</code></p></blockquote><h3 id="Lier-React-au-DOM"><a href="#Lier-React-au-DOM" class="headerlink" title="Lier React au DOM"></a>Lier React au DOM</h3><p>Pour que notre application soit effectivement affichée dans le DOM, nous allons utiliser le package ReactDOM.<br>Ce package va tout simplement nous permettre de “monter” notre application React sur un élément du DOM (ici un élément qui possède l’id “root”) :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ReactDOM.render(</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">MonApplication</span> /&gt;</span>,</span></div><div class="line">  document.getElementById('root')</div><div class="line">);</div></pre></td></tr></table></figure><p>La méthode <code>render</code>prend donc 2 paramètres, l’élément React, racine de notre application et le noeud du DOM sur lequel est attaché l’élément React. Avec ça, votre application React va apparaître dans votre navigateur (si il n’y pas d’erreurs bien sûr :) ).</p><p>C’est aussi simple que ça !</p><p>Mais, nous nous formons à une librairie dédiée à la création d’application web et paradoxalement, ce n’est qu’après plusieurs chapitres que le DOM est abordé, plutôt étrange non ? Il y a bien une raison.</p><h3 id="Le-virtual-DOM"><a href="#Le-virtual-DOM" class="headerlink" title="Le virtual DOM"></a>Le virtual DOM</h3><p>React implémente un concept très intéressant : le virtualDOM. Un concept qui va nous permettre de réaliser des applications web complexes et rapides !</p><h4 id="Le-DOM"><a href="#Le-DOM" class="headerlink" title="Le DOM"></a>Le DOM</h4><h5 id="Tout-d’abord-qu’est-ce-que-le-DOM"><a href="#Tout-d’abord-qu’est-ce-que-le-DOM" class="headerlink" title="Tout d’abord, qu’est-ce que le DOM ?"></a>Tout d’abord, qu’est-ce que le DOM ?</h5><p>Le DOM est l’API qui permet de manipuler le contenu hiérarchisé de notre page web (du HTML donc) sous forme d’arbre. Les éléments HTML constituent les noeuds de cet arbre.</p><h5 id="Les-limites"><a href="#Les-limites" class="headerlink" title="Les limites"></a>Les limites</h5><p>Un arbre, c’est pratique à parcourir, un peu moins à modifier (supprimer, ajouter des éléments) mais surtout, modifier le DOM implique le recalcule de la disposition et style de chacun des éléments de la page, conduisant à de sérieux problèmes de performance lorsque l’on réalise de nombreuses modifications.</p><p>Comment React tente de contrer cette limitation ?</p><h4 id="React-et-le-DOM"><a href="#React-et-le-DOM" class="headerlink" title="React et le DOM"></a>React et le DOM</h4><p>Voici une définition d’un élément React :</p><blockquote><p>“Un élement React est léger, sans état, immutable et constitue une représentation virtuel d’un élément DOM.”<br><sub>source : <a href="https://gist.github.com/sebmarkbage/fcb1b6ab493b0c77d589" target="_blank" rel="external">https://gist.github.com/sebmarkbage/fcb1b6ab493b0c77d589</a></sub></p></blockquote><p>Ainsi, lorsque l’on crée un élement <code>&lt;App/&gt;</code>, le composant racine de notre application React, on crée une copie simplifiée de l’application dans le “vrai” DOM, on parle de <strong>Virtual DOM</strong>.</p><h5 id="Comment-le-virtual-DOM-fonctionne"><a href="#Comment-le-virtual-DOM-fonctionne" class="headerlink" title="Comment le virtual DOM fonctionne ?"></a>Comment le virtual DOM fonctionne ?</h5><p>On l’a déjà dit, manipuler le DOM est lent, React va donc optimiser les appels au DOM que l’on va réaliser. Entre deux mises à jour, React va comparer le nouveau et l’ancier DOM virtuels de l’application et réaliser une comparaison, appelée <em>réconciliation</em>.</p><p>Grace à ça, nous n’avons jamais besoin de réfléchir à la façon dont notre UI doit se mettre à jour, React gère ça dans sont coin et va intelligemment cibler les noeuds du DOM où des modifications s’imposent et les appliquer, limitant ainsi les recalculs de layout de notre page. Un gain de temps de calcul très intéressant pour réaliser des applications rapides !</p><p>Tout l’intérêt du DOM virtuel réside dans le fait que manipuler un DOM virtuel est rapide puisque l’on manipule des objets JavaScript, rien ne se retrouve effectivement dessiner sur l’écran.</p><blockquote><p>Pour imager, cela revient à modifier la disposition des pièces d’un appartement sur un plan. C’est simple et rapide, bien plus en tout cas que de bouger les pièces d’un vrai appartement…. :)</p></blockquote><h5 id="Comment-le-virtualDOM-sait-qu’il-doit-etre-mis-a-jour"><a href="#Comment-le-virtualDOM-sait-qu’il-doit-etre-mis-a-jour" class="headerlink" title="Comment le virtualDOM sait qu’il doit être mis à jour ?"></a>Comment le virtualDOM sait qu’il doit être mis à jour ?</h5><p>Pour modifier l’état interne d’un composant, nous avons vu qu’il fallait impérativement appeler la méthode <code>setState</code>. Nous allons maintenant comprendre pourquoi.</p><p>A chaque fois que <code>setState</code> est appelé dans un composant, ce composant et tous les enfants de ce composant (qui reçoivent donc les <em>props</em> du composant modifié en cascade) vont devoir redéfinir leur affichage en conséquence et donc être redessinés.</p><p>Voici un schéma expliquant l’impact de <code>setState</code> sur l’arbre des composants d’une application React:</p><p><img src="/images/react-tree.png"><br><sub>source : <a href="http://techblog.constantcontact.com/software-development/reactive-component-based-uis/" target="_blank" rel="external">http://techblog.constantcontact.com/software-development/reactive-component-based-uis/</a></sub></p><p>Un composant dans lequel setState est appelé va donc modifier son noeud respectif dans le DOM virtuel ainsi que celui de tous ses enfants amenant à la mise à jour du DOM dans le navigateur.</p><p>On voit ici que <code>setState</code> a un très grand rôle puisque, si il sert effectivement à manipuler l’état interne d’un composant, il met également en marche tout le mécanisme permettant la mise à jour de l’UI via la comparaison des DOM virtuels, opération non neutre en terme de temps de calcul. Aussi, dans un but d’optimisation, React va regrouper certaines opérations d’update pour par exemple, ne réaliser qu’une seule comparaison d’arbres alors que 100 <code>setState</code> ont été appelés en très peu de temps dans différents composants. Si cette optimisation est pratique en terme de performance, elle peut être déroutante pour le développeur.</p><p>Exemple:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>() &#123;</div><div class="line">    <span class="keyword">this</span>.state = &#123; <span class="attr">counter</span>: <span class="number">1</span> &#125;;</div><div class="line">  &#125;</div><div class="line">  onClick() &#123;</div><div class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">counter</span>: <span class="number">2</span> &#125;);</div><div class="line">    <span class="comment">//Affiche : le compteur vaut: 1</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'le compteur vaut: '</span> + <span class="keyword">this</span>.state.counter);</div><div class="line">  &#125;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span> </span></span></div><div class="line">        <span class="attr">onClick</span>=<span class="string">&#123;this.onClick&#125;</span></div><div class="line">      &gt;</div><div class="line">        &#123;this.state.counter&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Cette exemple met en avant le fait que <code>setState</code> ne se comporte pas de façon synchrone, il faut donc le manipuler en gardant ça en tête. Pour contrer ce problème, la fonction <code>setState</code> peut prendre en deuxième argument un callback qui sera appelé une fois le state mis à jour.</p><p>La fonction onClick de l’exemple précédent serait modifiée comme tel:</p><p><code>this.setState({ counter: 2 }, () =&gt; console.log(&#39;le compteur vaut: &#39; + this.state.counter));</code></p><p>Dans cet article, nous avons vu qu’il était très simple de lier une application React au DOM. De plus, en filant la réflexion, nous avons pu appréhender en partie la “magie” de React et la raison pour laquelle la fonction <code>setState</code> peut être déroutante lorsqu’on la manipule.</p><div class="tags-container-bottom"><i class="fa fa-tag pr3 text-main-color"></i><a class="fw3 ph1 dib" href="/tags/bases/">#bases</a> <a class="fw3 ph1 dib" href="/tags/dom/">#dom</a></div><div id="disqus_thread" class="mt5"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div><div class="fl w-100 w-30-l center fw3 lh-copy pl4-ns tl black-50"><hr class="dn-l mw4 black-50 mt5"><div class="mt5 mt0-l"><article class="dt db-l mw8 mw8-m mw5-ns center ml0-l bg-white mv3"><div class="dn dtc-m db-l v-mid tc pr4 pr0-l" style="min-width:6rem"><img src="/images/profile.jpg" class="mb4-l br-100 h3 w3 h4-l w4-l dib" title="Gaël Servaud"></div><div class="dtc db-l v-mid lh-copy measure center f6 black-50 tj">Mon nom est Gaël Servaud<br>je suis développeur web fullstack freelance avec un fort intérêt pour les problématiques front-end.<br>Avec ce blog, je souhaite partager mes découvertes, mes projets perso et mes réflexions sur la librairie React et son écosystème foisonnant.</div></article></div><hr class="dn-l mw4 black-50 mt5"><div class="mt5 tc tl-l"><h3>Catégories</h3><p><a href="/categories/tutorial/">tutorial</a></p><p><a href="/categories/tutorial/debutant/">débutant</a></p></div><hr class="dn-l mw4 black-50 mt5"><div class="mt5 tc tl-l"><h3>Récemment</h3><p><a href="/conseil/coder-et-rester-motiver/">Coder et rester motiver</a></p><p><a href="/tutorial/library/React-Redux-from-scratch/">React Redux from scratch</a></p><p><a href="/tutorial/library/flux/redux-from-scratch/">Redux from scratch</a></p><p><a href="/tutorial/debutant/render-et-virtual-dom/">React et le DOM</a></p><p><a href="/tutorial/debutant/jsx/">Les bases du JSX</a></p></div></div></div></div></div></div><div class="bg-1 ph2 ph5-ns pv5"><div class="mv8"><div class="center tc"><div class="dib mh3"><a class="f3 f2-ns white dim" href="https://twitter.com/GaelS3" target="_blank"><i class="fa fa-twitter"></i></a></div><div class="dib mh3"><a class="f3 f2-ns white dim" href="https://github.com/GaelS" target="_blank"><i class="fa fa-github"></i></a></div></div><div class="f6 f5-ns center tc white pt5 fw3">All rights reserved | Gaël Servaud | 9 PEAKS | 2017</div></div></div><script type="text/javascript">var disqus_shortname="www-apprendre-react-fr";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script></body></html>