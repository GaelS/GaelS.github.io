<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Gérer l’état global d’une applicationAu cours d’articles précédents, nous avons réimplémenté de façon naïve la librairie Redux, une librairie majeure "><meta name="author" content="Gaël Servaud"><meta property="og:title" content="Supprimer Redux en utilisant l&#39;url de votre application"><meta property="og:site_name" content="Apprendre ReactJS"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><title>Supprimer Redux en utilisant l&#39;url de votre application - Apprendre ReactJS</title><link rel="stylesheet" href="//unpkg.com/tachyons/css/tachyons.min.css"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]--><link rel="stylesheet" href="/css/style.css"><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-96190899-1","auto"),ga("send","pageview")</script></head><body><div class="w-100 bg-1 ph5-ns ph3 text-light"><nav class="db dt-l w-100 mw8 center border-box pv3"><a class="db dtc-l v-mid link dim w-100 w-25-l tc tl-l mb2 mb0-l white" href="/" title="Apprendre ReactJS"><img src="/images/ReactLogo.svg" class="dib h3" alt="Apprendre ReactJS"></a><div class="db dtc-l v-mid w-100 w-75-l tc tr-l"><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/" title="Home">Home </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/archives" title="Archives">Archives </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/about" title="A propos">A propos</a></div></nav><div class="w-100 mw8 center vh-40 dt"><div class="dtc v-mid white"><h1 class="f1-l f2-m tc tc-m tl-ns">Supprimer Redux en utilisant l'url de votre application</h1><p class="f4 fw3 pab-100px tc tc-m tl-ns">09/05/2018</p></div></div><div class="relative w-100 mw8 center white dn dn-m db-ns"><i class="header-icon fa fa-code"></i></div></div><div class="w-100 ph2 ph4-m ph5-l mv5 mv6-l"><div class="content"><div class="mw8 center"><div class="cf"><div class="fl w-100 w-70-l mw7 left fw3 lh-copy pr4-ns pr0-m post-content"><div class="tags-container-vertical"><div class="tags-sub-container"><a class="fw3 ph1 dib" href="/tags/redux/">#redux</a> <a class="fw3 ph1 dib" href="/tags/react/">#react</a> <a class="fw3 ph1 dib" href="/tags/state/">#state</a> <a class="fw3 ph1 dib" href="/tags/management/">#management</a> <a class="fw3 ph1 dib" href="/tags/react-router/">#react router</a></div></div><h1 id="Gerer-l’etat-global-d’une-application"><a href="#Gerer-l’etat-global-d’une-application" class="headerlink" title="Gérer l’état global d’une application"></a>Gérer l’état global d’une application</h1><p>Au cours d’articles précédents, nous avons réimplémenté de façon naïve la librairie <strong>Redux</strong>, une librairie majeure dans l’écosystème React. Majeure car elle implémente de façon élégante le pattern <em>flux</em> développé par Facebook et qu’elle possède des features très sympas comme le <em>time traveling</em> (permettant de refaire l’historique des modifications du store Redux) associé au <a href="https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd?hl=fr" target="_blank" rel="noopener">Redux devTool</a> offrant une très bonne <em>developer experience</em>!</p><p>Il existe pas mal d’alternatives comme <a href="https://github.com/mobxjs/mobx" target="_blank" rel="noopener">MobX</a>, <a href="https://github.com/jamiebuilds/unstated" target="_blank" rel="noopener">Unstated</a> ou même - dans une certaine mesure - l’API <strong>context</strong> de <a href="https://reactjs.org/blog/2018/03/29/react-v-16-3.html" target="_blank" rel="noopener">React 16.3</a> qui est maintenant officielle !</p><p>Mais ici, nous allons voir comment pousser un peu plus la logique du <strong>state</strong> pour avoir une application qui possède bel et bien un <strong>state</strong> global avec… l’URL de l’application !</p><p><br><br><br><br><br><br><br></p><h1 id="URL-FTW"><a href="#URL-FTW" class="headerlink" title="URL FTW !"></a>URL FTW !</h1><p>Dans les <em>Single Page Application</em>, contrairement aux applications client/serveur classique, l’URL d’accès n’a pas beaucoup d’importance. Une fois que l’on arrive sur l’application, le javascript s’exécute et le navigateur ne va jamais se refraîchir. Toutes les interactions se passeront sur cette <em>page</em>. Le serveur ne sera appelé que via des requêtes AJAX.</p><p>Le fait d’arriver sur <code>https://monApp.fr</code> ou <code>https://monApp.fr?user=gael&amp;job=dev</code> ne change rien dans le cas d’une SPA qui n’utilise pas l’URL.</p><p>Pourtant, l’URL peut être utilisée comme une sauvegarde de l’état de notre application où chacune des mises à jour de l’URL va correspondre à une mise à jour de ce même état</p><p>Dans ces conditions, le fait d’arriver sur <code>https://monApp.fr</code> ou <code>https://monApp.fr?user=gael&amp;job=dev</code> aura un impact. Cela permettra d’ouvrir l’application dans un <em>état</em> particulier.</p><p><br><br><br><br><br><br><br></p><h1 id="Du-code-pour-les-braves"><a href="#Du-code-pour-les-braves" class="headerlink" title="Du code pour les braves !"></a>Du code pour les braves !</h1><p>J’ai commencé à implémenter cette idée sur un <em>side project</em> que j’ai développé dont voici le <a href="https://github.com/GaelS/first-contrib-app" target="_blank" rel="noopener">repo Github</a> et le <a href="https://first-contrib.surge.sh" target="_blank" rel="noopener">lien</a> pour jouer avec :)</p><p>Dans le cadre de cet article, j’ai cependant redéveloppé un <a href="https://codesandbox.io/s/5v0v7vwo6k" target="_blank" rel="noopener">codesandbox</a> pour avoir un code minimaliste pour se concentrer sur le sujet de cet article uniquement.</p><p>Tout d’abord, qu’est-ce qui nous intéresse dans l’URL ? Toute la partie de l’URL après le <strong>?</strong>.<br>Ce qu’on appelle les <em>search params</em>.</p><blockquote><p>Un peu de doc par <a href="https://developer.mozilla.org/en-US/docs/Web/API/URL/searchParams" target="_blank" rel="noopener">ici</a> sur le sujet.</p></blockquote><p><br><br><br></p><h2 id="Recuperer-des-elements-de-l’URL"><a href="#Recuperer-des-elements-de-l’URL" class="headerlink" title="Récupérer des éléments de l’URL"></a>Récupérer des éléments de l’URL</h2><p>Pour notre exemple, nous n’allons manipuler qu’un seul paramètre dans l’URL : <em>query</em>.</p><p>Pour le récupérer (si tant est qu’il soit effectivement présent dans l’URL), on va utiliser une propriété de l’objet <code>window.location.search</code> qui correspond à toute la chaîne de caractères après le <strong>?</strong>.</p><p>Ainsi avec l’url suivante: <code>www.first-contrib?query=react</code>, on obtient :</p><p><code>console.log(window.location.search); // &quot;?query=react&quot;</code></p><p>Idéalement, plutôt qu’un <code>string</code>, il serait préférable de manipuler un objet correctement formatté. Pour cela, on va utiliser l’objet <code>URLSearchParams</code> accessible dans les navigateurs récents. Si non, vous pouvez le polyfiller via <a href="https://www.npmjs.com/package/url-search-params-polyfill" target="_blank" rel="noopener">cette librairie</a> par exemple.</p><p>En code cela donne cela :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getParams</span>(<span class="params">location</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> searchParams = <span class="keyword">new</span> URLSearchParams(location.search);</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">query</span>: searchParams.get(<span class="string">'query'</span>) || <span class="string">''</span>,</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ainsi,</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//getParams declaration</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> params = getParams(<span class="string">'www.first-contrib.fr?query=react'</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(params) <span class="comment">// &#123; query: "react" &#125;</span></div></pre></td></tr></table></figure><p>Parfait, on peut récupérer un objet depuis notre URL. Maintenant comment faire fonctionner ça avec notre application qui intègre la librairie <strong>react router</strong> pour la gestion du routing ?</p><p>On va tenter d’afficher l’objet que l’on obtient depuis l’URL en créant un <code>router</code> qui affichera un composant prenant pour <code>props</code> les éléments de l’URL.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</div><div class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">"react-dom"</span>;</div><div class="line"><span class="keyword">import</span> &#123; BrowserRouter <span class="keyword">as</span> Router, Route &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</div><div class="line"></div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="comment">// getParams code above</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> MainPage = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</div><div class="line">  <span class="comment">//on ne sais pas encore d'où query va venir...</span></div><div class="line">  <span class="keyword">let</span> query = <span class="string">''</span>;</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;h2&gt;&#123;`Ma query : $&#123;query&#125;`&#125;&lt;/h2&gt;</div><div class="line">  );</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> (</div><div class="line">  &lt;React.Fragment&gt;</div><div class="line">    &lt;Router&gt;</div><div class="line">      &lt;React.Fragment&gt;</div><div class="line">        &lt;Route path="/" component=&#123;MainPage&#125; /&gt;</div><div class="line">      &lt;/React.Fragment&gt;</div><div class="line">    &lt;/Router&gt;</div><div class="line">  &lt;/React.Fragment&gt;</div><div class="line">);</div><div class="line"></div><div class="line">render(&lt;App /&gt;, document.getElementById("root"));</div></pre></td></tr></table></figure><p>En l’état, on a bien un router qui affiche le composant <code>MainPage</code> à l’URL “/“ mais on ne sais pas encore récupérer la valeur de <code>query</code> éventuellement présente dans l’URL.</p><p>Pour obtenir <code>query</code>, on va devoir jouer avec la fonction <code>getParams</code> que l’on a créé précédemment ainsi que les <code>props</code> que le composant <code>MainPage</code> reçoit de façon implicite via le composant <code>Route</code> à cette ligne : <code>&lt;Route path=&quot;/&quot; component={MainPage} /&gt;</code></p><p>Si on logge l’objet <code>props</code> que reçoit <code>MainPage</code>, on voit qu’il ressemble à ça :</p><p><code>{match: Object, location:Object, history: Object, /*d&#39;autres valeurs */}</code></p><p>et Ô miracle, ce <code>props</code> possède l’objet <code>location</code>, similaire au <code>window.location</code> qu’on a manipulé tout à l’heure ! Ainsi, on peut récupérer les valeurs de l’URL dans <code>MainPage</code>. On va donc mettre à jour le code de <code>MainPage</code> en conséquence:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> MainPage = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">const</span> &#123; location &#125; = props;</div><div class="line">  <span class="keyword">const</span> &#123; query &#125; = getParams(location);</div><div class="line">  </div><div class="line">  <span class="keyword">return</span> (</div><div class="line">      &lt;h2&gt;&#123;`Ma query: $&#123;query&#125;`&#125;&lt;/h2&gt;</div><div class="line">  );</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Maintenant, le composant <code>MainPage</code> rend des éléments en fonction de l’URL!</p><blockquote><p>Question subsidiare : Quel est l’intérêt de manipuler <code>location</code> à travers <strong>react router</strong> s’il existe déjà dans l’objet <code>window</code> comme on a vu précédemment ?</p><p>Et bien, avec <strong>React</strong> les composants réagissent à des modifications de <em>state</em> interne ou de <em>props</em> externes. <strong>React Router</strong>, lui, permet de relier l’état de l’app à l’URL du navigateur. Ainsi, une modification de l’URL lance une mise à jour de l’application.</p></blockquote><p><br><br><br></p><h2 id="Mettre-a-jour-l’URL-et-donc-le-state"><a href="#Mettre-a-jour-l’URL-et-donc-le-state" class="headerlink" title="Mettre à jour l’URL (et donc le state) !"></a>Mettre à jour l’URL (et donc le state) !</h2><p>Maintenant que l’on est capable de lire l’URL du navigateur, on va tenter de la mettre à jour depuis notre application.</p><p>On va créer un composant qui va modifier l’URL en fonction de la valeur d’un <code>input</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">InputPage</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  </div><div class="line">  state = &#123; <span class="attr">inputValue</span>: <span class="string">""</span> &#125;;</div><div class="line"></div><div class="line">  updateInputValue = <span class="function"><span class="params">e</span> =&gt;</span> <span class="keyword">this</span>.setState(&#123; <span class="attr">inputValue</span>: e.target.value &#125;);</div><div class="line">  </div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;React.Fragment&gt;</div><div class="line">        &lt;input</div><div class="line">          type="text"</div><div class="line">          placeholder="Query à modifier"</div><div class="line">          value=&#123;this.state.inputValue&#125;</div><div class="line">          onChange=&#123;this.updateInputValue&#125;</div><div class="line">        /&gt;</div><div class="line">        &lt;input type="button" value="Mettre à jour l'URL" onClick=&#123;null&#125; /&gt;</div><div class="line">      &lt;/React.Fragment&gt; </div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>En l’état, ce composant se contente d’afficher une valeur mais est incapable de modifier l’URL. Ce que l’on souhaite, c’est que l’évènement <code>click</code> sur le bouton récupère les valeurs de l’input et mette à jour l’URL en conséquence. On va donc devoir écrire la fonction du <code>onClick</code> de l’input de type <em>button</em>.</p><p>Pour rappel, on a vu plus haut que l’objet <code>props</code> que reçoit <code>MainPage</code> ressemble à ça :</p><p><code>{match: Object, location:Object, history: Object, /*d&#39;autres valeurs */}</code></p><p>Plus précisément, il contient un objet <code>history</code> décrit dans la documentation de <strong>React Router</strong> <a href="https://reacttraining.com/react-router/web/api/history" target="_blank" rel="noopener">ici</a>…</p><p>Ici, nous allons tout particulièrement nous intéresser à la fonction <code>push</code> qui selon la doc de <strong>React Router</strong> :</p><blockquote><p>Pushes a new entry onto the history stack</p></blockquote><p>Autrement dit, <code>push</code> va permettre de mettre à jour l’URL !</p><p>Seulement, si la valeur <code>query</code> vaut “javacript” par exemple, il faut que la mise à jour de l’URL donne <code>www.monApp.fr?query=javascript</code>. Il faut donc que l’on génère les <code>searchParams</code> de notre nouvelle URL. Pour ça, l’objet <code>URLSearchParams</code> va nous aider encore une fois !</p><p>Après la fonction <code>getParams</code> on va donc écrire la fonction <code>setParams</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setParams</span>(<span class="params">&#123; query &#125;</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> searchParams = <span class="keyword">new</span> URLSearchParams();</div><div class="line">  searchParams.set(<span class="string">"query"</span>, query || <span class="string">""</span>);</div><div class="line">  <span class="keyword">return</span> searchParams.toString();</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Ainsi, si on utilise la fonction comme suit:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> url = setParams(&#123; <span class="attr">query</span>: <span class="string">"javascript"</span> &#125;);</div><div class="line"><span class="built_in">console</span>.log(url); <span class="comment">// "query=javascript"</span></div></pre></td></tr></table></figure><p>Maintenant, dans notre input, on va modifier la fonction <code>onClick</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">InputPage</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  state = &#123; <span class="attr">inputValue</span>: <span class="string">""</span> &#125;;</div><div class="line">  updateInputValue = <span class="function"><span class="params">e</span> =&gt;</span> <span class="keyword">this</span>.setState(&#123; <span class="attr">inputValue</span>: e.target.value &#125;);</div><div class="line">  </div><div class="line">  <span class="comment">//NOTRE FONCTION !</span></div><div class="line">  updateURL = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> url = setParams(&#123; <span class="attr">query</span>: <span class="keyword">this</span>.state.inputValue &#125;);</div><div class="line">    <span class="comment">//ne pas oublier le "?" devant les "search params" !</span></div><div class="line">    <span class="keyword">this</span>.props.history.push(<span class="string">`?<span class="subst">$&#123;url&#125;</span>`</span>);</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;React.Fragment&gt;</div><div class="line">        &lt;input</div><div class="line">          type="text"</div><div class="line">          placeholder="Query à modifier"</div><div class="line">          value=&#123;this.state.inputValue&#125;</div><div class="line">          onChange=&#123;this.updateInputValue&#125;</div><div class="line">        /&gt;</div><div class="line">        &lt;input </div><div class="line">          type="button"</div><div class="line">          value="Mettre à jour l'URL"</div><div class="line">          onClick=&#123;this.updateURL&#125; /&gt;</div><div class="line">      &lt;/React.Fragment&gt; </div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Maintenant, si on change la valeur de l’input et que l’on clique sur le bouton, on a bien l’URL qui se met à jour ainsi que le composant <code>MainPage</code> qui affiche la nouvelle valeur !</p><p>Une des choses vraiment sympas avec le stockage de l’état de l’app dans l’URL, c’est le copier/coller de lien. Avec toutes les infos déjà présentes dans l’URL, l’application affiche directement l’état dans lequel on souhaite la trouver ! Essayez en changeant la valeur de l’URL dans le navigateur !</p><p>Dans le cas d’un moteur de recherche, on peut lancer la recherche dès le chargement de l’application par exemple. Dans mon <a href="https://github.com/GaelS/first-contrib-app" target="_blank" rel="noopener">application</a> j’utilise <a href="https://github.com/apollographql/react-apollo" target="_blank" rel="noopener">react-apollo</a> mais de façon naïve, on peut implémenter la même chose avec n’importe quel client HTTP.</p><p>Essayons ici avec la librairie <code>Axios</code> et l’API Github REST qui ne nécessite pas d’authentification pour fonctionner de créer un composant qui lance des requêtes des éléments en fonction des <code>props</code> qu’ils reçoient:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">const</span> httpClient = axios.create(&#123;</div><div class="line">  <span class="attr">baseURL</span>: <span class="string">"https://api.github.com"</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResultsPage</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  state = &#123; <span class="attr">results</span>: [], <span class="attr">loading</span>: <span class="literal">false</span>, <span class="attr">error</span>: <span class="literal">false</span> &#125;;</div><div class="line"></div><div class="line">  componentDidMount() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.searchRepositories(<span class="keyword">this</span>.props.query);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  componentWillReceiveProps(nextProps) &#123;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (nextProps.query !== <span class="keyword">this</span>.props.query) &#123;</div><div class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">query</span>: nextProps.query &#125;);</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.searchRepositories(nextProps.query);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  searchRepositories = <span class="function"><span class="params">query</span> =&gt;</span> &#123;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (!query) &#123;</div><div class="line">      <span class="comment">//si la valeur query est nulle, on ne</span></div><div class="line">      <span class="comment">//lance pas la requête </span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.setState(&#123;</div><div class="line">        <span class="attr">results</span>: []</div><div class="line">      &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">loading</span>: <span class="literal">true</span>, <span class="attr">error</span>: <span class="literal">false</span> &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> httpClient</div><div class="line">      .get(<span class="string">`/search/repositories?q=<span class="subst">$&#123;query&#125;</span>`</span>)</div><div class="line">      .then(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span></div><div class="line">        <span class="keyword">this</span>.setState(&#123;</div><div class="line">          <span class="attr">results</span>: data.items,</div><div class="line">          <span class="attr">loading</span>: <span class="literal">false</span></div><div class="line">        &#125;)</div><div class="line">      )</div><div class="line">      .catch(<span class="function"><span class="params">e</span> =&gt;</span> <span class="keyword">this</span>.setState(&#123; <span class="attr">loading</span>: <span class="literal">false</span>, <span class="attr">error</span>: <span class="literal">true</span> &#125;));</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  </div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;div&gt;</div><div class="line">        &#123;this.state.results.map(repo =&gt; (</div><div class="line">          &lt;div&gt;</div><div class="line">            &lt;a key=&#123;repo.id&#125; href=&#123;repo.html_url&#125;&gt;</div><div class="line">              &#123;repo.name&#125;</div><div class="line">            &lt;/a&gt;</div><div class="line">            &lt;div&gt;&#123;`by $&#123;repo.owner.login&#125;`&#125;&lt;/div&gt;</div><div class="line">          &lt;/div&gt;</div><div class="line">        ))&#125;</div><div class="line">      &lt;/div&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Ce composant <code>ResultsPage</code> récupère le props <code>query</code> que l’on récupère depuis l’URL (je crois qu’on a compris depuis le temps) et lance directement une requête au montage du composant avec le <em>lifecycle</em> <code>componentDidMount</code> ainsi qu’à la mise à jour de la valeur de <code>query</code> dans avec <code>componentWillReceiveProps</code>. Et, tadam, on a un composant qui requête automatiquement des valeurs au changement de la valeur de l’URL !!</p><p>Pour rappel un <a href="https://codesandbox.io/s/5v0v7vwo6k" target="_blank" rel="noopener">codesandbox</a> est là pour tester en live.</p><p>Dans notre cas, nous n’avons qu’une valeur mais cela devient très sympa si vous voulez gérer la pagination, un filter sur votre recherche, le tri descendant ou ascendant, …, bref tous les paramètres qu’acceptent votre API !</p><p>Dans tous les cas, le fonctionnement est le même, les éléments qui modifient le state modifient l’URL qui se propagent dans tous les enfants pour arriver au composant qui effectue la requête !</p><p><br><br><br><br><br><br><br></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Voilà, c’est tout pour moi ! React et le state, un univers impitoyable mais dans lequel il y a la possibilité des choses à faire pour s’amuser et fournir des expériences utilisateurs sympas et différentes.</p><p>J’espère que cet article vous aura plus, n’hésitez pas à laisser des commentaires.</p><div class="tags-container-bottom"><i class="fa fa-tag pr3 text-main-color"></i><a class="fw3 ph1 dib" href="/tags/redux/">#redux</a> <a class="fw3 ph1 dib" href="/tags/react/">#react</a> <a class="fw3 ph1 dib" href="/tags/state/">#state</a> <a class="fw3 ph1 dib" href="/tags/management/">#management</a> <a class="fw3 ph1 dib" href="/tags/react-router/">#react router</a></div><div id="disqus_thread" class="mt5"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div><div class="fl w-100 w-30-l center fw3 lh-copy pl4-ns tl black-50"><hr class="dn-l mw4 black-50 mt5"><div class="mt5 mt0-l"><article class="dt db-l mw8 mw8-m mw5-ns center ml0-l bg-white mv3"><div class="dn dtc-m db-l v-mid tc pr4 pr0-l" style="min-width:6rem"><img src="/images/profile.jpg" class="mb4-l br-100 h3 w3 h4-l w4-l dib" title="Gaël Servaud"></div><div class="dtc db-l v-mid lh-copy measure center f6 black-50 tj">Mon nom est Gaël Servaud<br>je suis développeur web fullstack freelance avec un fort intérêt pour les problématiques front-end.<br>Avec ce blog, je souhaite partager mes découvertes, mes projets perso et mes réflexions sur la librairie React et son écosystème foisonnant.</div></article></div><hr class="dn-l mw4 black-50 mt5"><div class="mt5 tc tl-l"><h3>Catégories</h3><p><a href="/categories/tutorial/">tutorial</a></p><p><a href="/categories/tutorial/library/">library</a></p><p><a href="/categories/tutorial/library/state/">state</a></p></div><hr class="dn-l mw4 black-50 mt5"><div class="mt5 tc tl-l"><h3>Récemment</h3><p><a href="/tutorial/library/state/Supprimer-Redux-en-utilisant-l-url-de-votre-application/">Supprimer Redux en utilisant l&#39;url de votre applic</a></p><p><a href="/uncategorized/terminer-ses-projets-perso/">Terminer ses projets perso...</a></p><p><a href="/tutorial/library/React-Redux-from-scratch/">React Redux from scratch</a></p><p><a href="/tutorial/library/flux/redux-from-scratch/">Redux from scratch</a></p><p><a href="/tutorial/debutant/render-et-virtual-dom/">React et le DOM</a></p></div></div></div></div></div></div><div class="bg-1 ph2 ph5-ns pv5"><div class="mv8"><div class="center tc"><div class="dib mh3"><a class="f3 f2-ns white dim" href="https://twitter.com/GaelS3" target="_blank"><i class="fa fa-twitter"></i></a></div><div class="dib mh3"><a class="f3 f2-ns white dim" href="https://github.com/GaelS" target="_blank"><i class="fa fa-github"></i></a></div></div><div class="f6 f5-ns center tc white pt5 fw3">All rights reserved | Gaël Servaud | 9 PEAKS | 2017</div></div></div><script type="text/javascript">var disqus_shortname="www-apprendre-react-fr";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script></body></html>